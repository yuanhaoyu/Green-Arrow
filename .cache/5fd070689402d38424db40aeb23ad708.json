{"dependencies":[{"name":"../common/tool","loc":{"line":1,"column":18}}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Star_Arrow = exports.Action_Arrow = undefined;\n\nvar _tool = require(\"../common/tool\");\n\nvar _tool2 = _interopRequireDefault(_tool);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass Arrow {\n  constructor(config) {\n    this.base = {\n      \"src\": config.src,\n      \"pid\": config.pid,\n      \"channel\": config.channel,\n      \"sc\": '',\n      \"ua\": '',\n      \"startTime\": '',\n      \"endTime\": ''\n    };\n    this.url = config.url;\n    this.type = config.type && config.type.toUpperCase() === 'POST' ? config.type : 'GET';\n    this.version = '0.0.0';\n    this._init();\n  }\n  _init() {\n    // 初始化配置\n    this.base.sc = _tool2.default.getSC();\n    this.base.src = _tool2.default.getUrl();\n    this.ua = _tool2.default.getUA();\n  }\n  sendMsg(msg = {}) {\n    if (this.type === 'GET') {\n      let img = new Image();\n      let query = Object.assign({}, { \"base\": this.base, \"val\": msg, \"now\": _tool2.default.getNow() });\n      img.src = this.url + '?data=' + encodeURIComponent(JSON.stringify(query));\n    } else {\n      // todo: use post ajax\n    }\n  }\n}\n\nclass Action_Arrow extends Arrow {\n  auto() {\n    // todo: add watcher\n  }\n  ok(msg) {\n    this.sendMsg(msg);\n  }\n}\n\nclass Star_Arrow extends Arrow {\n  constructor(config) {\n    super(config);\n    this._start();\n    this._end();\n  }\n  _start() {\n    this.base.startTime = _tool2.default.getNow();\n    this.sendMsg({ \"action\": \"in\" });\n  }\n  _end() {\n    let that = this;\n    (function (win, t) {\n      win.onbeforeunload = function (e) {\n        t.base.startTime = _tool2.default.getNow();\n        t.sendMsg({ \"action\": \"out\" });\n      };\n    })(window, that);\n  }\n}\n\nexports.Action_Arrow = Action_Arrow;\nexports.Star_Arrow = Star_Arrow;"},"hash":"c97c9060bbe24d55d055f2a15addb223"}